<div class="main-container">
  <div class="title">
    <p>TODO LIST</p>
  </div>
  <div class="content">
    <div class="search-bar">
      <mat-form-field appearance="outline" class="search-mat custom-outline">
        <mat-label>Busca tu tarea pendiente...</mat-label>
        <input matInput (keyup)="applyFilter($event)">
        <mat-icon matSuffix class="search-icon">search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Filtra tus tareas</mat-label>
        <mat-select (selectionChange)="filterSelect($event)">
          <mat-option value="1">Completas</mat-option>
          <mat-option value="2">Pendientes</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="add-button">
        <a mat-mini-fab routerLink="." class="icon-background" (click)="openDialog()">
          <mat-icon>add</mat-icon>
        </a>
      </div>
    </div>
    <div *ngIf="isLoading" class="spinner-container notes">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
    <div class="notes" *ngIf="!isLoading">
      <div *ngIf="taskList.length > 0">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 angular-table">
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef> Tarea </th>
            <td mat-cell *matCellDef="let task">
              <span [ngClass]="{'note-text': task.isCompleted}">{{task.title}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Descripción </th>
            <td mat-cell *matCellDef="let task"> {{task.description}} </td>
          </ng-container>

          <ng-container matColumnDef="isCompleted">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let task">
              <mat-checkbox [checked]="task.isCompleted" (change)="verifyCheckbox($event, task)"></mat-checkbox>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let row" class="icon-container">
             
              <button mat-icon-button class="icon edit-button" (click)="openDialog(row)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button class="icon delete-button" (click)="deleteOneTask(row.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator [length]="dataSource.data.length" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]"></mat-paginator>

      </div>
      <div *ngIf="taskList.length === 0" class="empty">
        <img src="../../assets/empty-list.svg" alt="No hay tareas">
        <p>No hay tareas pendientes...</p>
      </div>
    </div>
  </div>
</div>

<ng-template #content>
  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
    <div class="dialog-create">
      <p class="dialog-title">{{ updating ? 'Editar Tarea' : 'Nueva Tarea' }}</p>
      <mat-form-field appearance="outline" class="dialog-input">
        <input matInput placeholder="Título de la tarea" formControlName="Title">
      </mat-form-field>
      <mat-form-field appearance="outline" class="dialog-input">
        <input matInput placeholder="Descripción de la tarea" formControlName="Description">
      </mat-form-field>
      <div class="dialog-buttons">
        <button mat-raised-button class="add-button-dialog" type="submit">Aplicar</button>
        <button mat-stroked-button color="basic" (click)="dialogRef.close()" class="cancel-button">Cancelar</button>
      </div>
    </div>
  </form>
</ng-template>
